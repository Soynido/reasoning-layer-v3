---
version: 1.8
original_version: 1.0
updated: 2025-11-12T16:00:00.000Z
confidence: 0.97
baseline_saved: true
deviation_mode: ui_driven
commit: pending
vsix: reasoning-layer-rl4-2.7.0-adr-detection.vsix
snapshot_validated: true
milestone: Mermaid Diagrams + Plan Evolution Tracking
---

# RL4 Strategic Plan

## Phase
E4 - Smart UI with LLM-Validated KPIs

## Goal
Transform RL4 UI from "data display" to "actionable insights" via LLM-validated Smart Components.

## Timeline
- Phase E3.3: âœ… COMPLETE (2025-11-12)
- Phase E4 Start: 2025-11-12 (15:30)
- Target: 2025-11-16 (4 days)
- Current: Day 1/4 (95% confidence)
- Status: ðŸŸ¢ Excellent momentum

**Phase E3.3 Objectives (COMPLETE):**
1. âœ… Simplify UI to 1 button ("Generate Context Snapshot")
2. âœ… Eliminate fake/static data (patterns, forecasts, goals)
3. âœ… Establish agent feedback loop (prompt â†’ agent â†’ .RL4 files â†’ RL4 parses)
4. âœ… Create persistent state files (Plan/Tasks/Context/ADRs.RL4)
5. âœ… Historical compression (30 days â†’ 2KB JSON)
6. âœ… ADR auto-detection (commit scoring)
7. âœ… Deviation Guard (baseline tracking)

**Phase E4 Objectives (ACTIVE):**
1. [x] UI-Driven Deviation Mode (ADR-009) âœ… DONE â€” User chooses perception angle
2. [ ] Smart UI Components (ADR-006) â€” LLM-validated insights, not raw data
3. [ ] Real-time .RL4 file refresh (FileWatchers â†’ UI update)
4. [ ] Interactive ADR timeline visualization

**Milestones Achieved (Day 1):**
- âœ… UnifiedPromptBuilder.ts created (generates single prompt)
- âœ… BlindSpotDataLoader.ts (loads real timeline/git/health)
- âœ… ADRParser.ts (parses agent-proposed ADRs)
- âœ… PlanTasksContextParser.ts (reads/validates .RL4 files)
- âœ… FileWatchers integrated (monitors .RL4 changes)
- âœ… ADR-005 parser regex fixed (ADR-XXX: format)
- âœ… HistorySummarizer.ts (30 days â†’ 2KB JSON compression)
- âœ… BiasCalculator.ts (deviation detection from baseline)
- âœ… ADRSignalEnricher.ts (auto-detect ADRs from commits)
- âœ… Deviation Guard integrated (STRICT mode active)
- âœ… ADR-005, ADR-006, ADR-007 documented
- âœ… Stable commit: 140406e
- âœ… Extension installed: v2.7.0-adr-detection

**Success Criteria:**
- [x] UI reduced to single action
- [x] Prompt generation functional
- [x] Real-time data only (cycles, commits, health)
- [x] Agent can update Plan/Tasks/Context.RL4
- [x] RL4 detects changes and re-parses (FileWatchers active)
- [x] Confidence/Bias metrics calculated (71% / 0%)

## Phase Evolution Tracking

### Phase E3.3 â†’ E4.1 Transition (2025-11-12)

**ADDED:**
- `UnifiedPromptBuilder.ts` (Single context snapshot generator)
- `HistorySummarizer.ts` (30 days â†’ 2KB JSON compression)
- `BiasCalculator.ts` (Deviation tracking from baseline)
- `ADRSignalEnricher.ts` (Auto-detect ADRs from commits)
- `ADRParser.ts` (Parse ADRs.RL4 â†’ adrs.jsonl)
- `PlanTasksContextParser.ts` (Parse Plan/Tasks/Context.RL4)
- `BlindSpotDataLoader.ts` (Load timeline/git/health)
- `.reasoning_rl4/Plan.RL4` (Strategic intent persistence)
- `.reasoning_rl4/Tasks.RL4` (Tactical TODOs persistence)
- `.reasoning_rl4/Context.RL4` (Operational state persistence)
- `.reasoning_rl4/ADRs.RL4` (Agent-proposed ADRs)
- `.reasoning_rl4/.baseline/Plan.RL4.v1.0` (Immutable baseline for bias calc)
- FileWatchers for Plan/Tasks/Context/ADRs.RL4
- UI-Driven Deviation Mode selector (ðŸ”´/ðŸŸ¡/ðŸŸ¢/âšª)
- Dynamic threshold system (0%/25%/50%/100%)
- Mode-specific agent instructions in prompt

**MODIFIED:**
- WebView UI: 4 tabs (Now/Before/Next/Restore) â†’ 1 button + mode selector
- `extension.ts`: Message handler now accepts `deviationMode` param
- `UnifiedPromptBuilder.generate()`: Signature changed (+deviationMode param)
- Prompt header: Now displays user-selected deviation mode
- Bias calculation: Now uses dynamic threshold (not static config)
- Deviation Guard section: Adapts rules based on chosen mode
- Confidence metric: 71% â†’ 97% (increased trust in system)

**REMOVED:**
- Static patterns.json, forecasts.json, goals.json (fake data)
- 4-tab UI system (Now/Before/Next/Restore)
- Legacy `snapshotInterval` (auto-push every 10s)
- Legacy message types (updateNow, updateBefore, etc.)
- Static `deviation_mode` in kernel_config.json (now UI-driven)
- Global threshold config (now per-snapshot)
- PromptBridge separate prompts (unified into single snapshot)

**WHY:**
- User insight 1: "Patterns never change, seems fake" â†’ Removed fake data
- User insight 2: "Too many buttons, unclear workflow" â†’ 1 button UI
- User insight 3: "How do I update RL4 state?" â†’ .RL4 feedback loop
- User insight 4: "Le threshold est une prÃ©fÃ©rence USER" â†’ UI-driven mode

### Phase E4.1 â†’ E4.2 Transition (In Progress)

**ADDED:**
- Mermaid diagrams to all ADRs (ADR-005 to ADR-009)
- `.reasoning_rl4/ADR_TEMPLATE.md` (Template for future ADRs)
- Phase Evolution Tracking section in Plan.RL4 (this section)

**PLANNED (E4.2):**
- Smart UI Components (NextStepsCard, ConfidenceGauge, etc.)
- Real-time .RL4 file refresh in UI
- Interactive ADR timeline visualization

**Next Phase (E4): Smart UI with LLM-Validated KPIs**
- Rationale: See ADR-006 (2025-11-12)
- Problem: Raw stats meaningless without context ("Et alors ? C'est grave ?")
- Solution: UI displays LLM insights, not raw data
- Architecture: Kernel (dumb) â†’ Prompt (compress) â†’ LLM (validate) â†’ .RL4 (persist) â†’ UI (smart display)
- Components:
  - NextStepsCard (Tasks.RL4 â†’ P0 tasks)
  - ConfidenceGauge (Plan.RL4 â†’ 71% metric)
  - BlockersAlert (Tasks.RL4 â†’ blockers)
  - CognitiveLoadMeter (Context.RL4 â†’ observations)
  - TimelineChart (HistorySummary â†’ trends)
  - DecisionHistory (ADRs.RL4 â†’ ADR timeline)
- Constraint: Single CTA remains ("Generate Context Snapshot")
- Success: User knows WHAT TO DO, not just "what happened"
