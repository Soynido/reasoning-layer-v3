# âœ… V2.0.1 - Validation Instructions

**Fix Applied**: CognitiveScheduler auto-respawn on VS Code reload

---

## ğŸ”§ What Was Fixed

### Problem
- CognitiveScheduler started on first activation (14:52)
- Generated 35 cycles until VS Code reload (16:39)
- **Timer NOT restarted after reload** â†’ No cycles for 1h05

### Root Cause
```typescript
// BEFORE (âŒ Single-use timer)
const scheduler = new CognitiveScheduler();
scheduler.start();
// Timer lost on VS Code reload
```

### Solution Applied
```typescript
// AFTER (âœ… Auto-respawn singleton)
let cognitiveScheduler: CognitiveScheduler | null = null; // Singleton

// In activate():
if (!cognitiveScheduler) {
    cognitiveScheduler = new CognitiveScheduler();
}
// CRITICAL: Always restart timer (survives reload)
kernel.timerRegistry.clear('kernel:cognitive-cycle');
kernel.scheduler.start(interval);

// In deactivate():
kernel.timerRegistry.clear('kernel:cognitive-cycle'); // Clean stop
await ledger.flush(); // Flush before shutdown
```

**Impact**:
- âœ… Scheduler survives VS Code reloads
- âœ… Timer auto-restarts on every activation
- âœ… Clean flush on deactivate
- âœ… No data loss between sessions

---

## ğŸš€ Validation Steps (3 minutes)

### 1ï¸âƒ£ Reload Cursor/VS Code

```
Cmd+Shift+P > Developer: Reload Window
```

**Expected after 10s:**
```
ğŸ§  RL4 CognitiveScheduler created (new instance)
âœ… RL4 Kernel initialized
ğŸ§  RL4 CognitiveScheduler started (10000ms cycles) - auto-respawn enabled
```

---

### 2ï¸âƒ£ Wait for 3 Cycles (30s)

```bash
# Monitor cycles.jsonl in real-time
cd "/Users/valentingaludec/Reasoning Layer V3"
watch -n 1 'wc -l .reasoning_rl4/ledger/cycles.jsonl'
```

**Expected:**
- Cycle count increases by 1 every 10 seconds
- After 30s: 3 new cycles

---

### 3ï¸âƒ£ Run 10-Cycle Test

```bash
cd "/Users/valentingaludec/Reasoning Layer V3"
./scripts/test-10-cycles.sh
```

**Expected Output:**
```
âœ… SUCCESS: 10+ cycles completed!
ğŸ“Š Final cycles count: 10
âœ¨ New cycles generated: 10
ğŸ” Chain integrity: OK (1 genesis + 9 linked)
```

---

### 4ï¸âƒ£ Verify Auto-Respawn After Reload

```bash
# Note current cycle count
BEFORE=$(wc -l < .reasoning_rl4/ledger/cycles.jsonl)
echo "Cycles before reload: $BEFORE"

# Reload Cursor (Cmd+Shift+P > Developer: Reload Window)

# Wait 30 seconds

# Check new cycles
AFTER=$(wc -l < .reasoning_rl4/ledger/cycles.jsonl)
echo "Cycles after reload: $AFTER"
echo "New cycles generated: $(($AFTER - $BEFORE))"
```

**Expected:**
```
Cycles before reload: 10
Cycles after reload: 13
New cycles generated: 3
```

âœ… **If 3+ cycles generated after reload â†’ FIX VALIDATED**

---

## ğŸ“Š Success Criteria

- [ ] Extension activates without errors
- [ ] CognitiveScheduler starts automatically
- [ ] 10 cycles generated in 100-120s
- [ ] **NEW:** Cycles continue after VS Code reload âœ…
- [ ] **NEW:** Auto-respawn logs visible in Output Channel
- [ ] MerkleRoot varies when new commits/files added
- [ ] Clean flush on deactivate (no data loss)

---

## ğŸ› Troubleshooting

### Cycles Still Not Generated After Reload?

```bash
# Check if timer is registered
grep -i "CognitiveScheduler started" # in Output Channel

# Check if timer is running
cat .reasoning_rl4/state/health.jsonl | tail -1 | jq '.'

# Manual cycle trigger
# Cmd+Shift+P > Reasoning: Run Cognitive Cycle
```

### MerkleRoot Still Identical?

**Normal!** If no new commits/files, inputHash is same â†’ idempotence skip.

To generate different merkleRoots:
```bash
# Create a new commit
echo "test $(date)" >> test-validation.md
git add test-validation.md
git commit -m "test: force new cycle with different input"

# Wait 15 seconds
# â†’ Next cycle will have different merkleRoot
```

---

## ğŸ¯ Next Steps After Validation

### If Test Passes (10+ cycles generated):

```bash
# Tag v2.0.1
git add extension/extension.ts .reasoning/kernel_config.json
git commit -m "fix(kernel): CognitiveScheduler auto-respawn on VS Code reload

âŒ Problem: Timer lost after reload (35 cycles â†’ 1h05 silence)
âœ… Fix: 
- Singleton scheduler with auto-restart on activate
- Timer cleared before re-registration
- Clean flush on deactivate

Impact:
- 100% timer persistence across reloads
- No manual restart needed
- Zero data loss

Tests: 10-cycle validation + reload test passed"

git tag -a v2.0.1 -m "RL4: CycleAggregator + Auto-Respawn validated

âœ… CognitiveScheduler operational (35+ cycles)
âœ… Auto-respawn after VS Code reload fixed
âœ… Clean flush on deactivate
âœ… 10-cycle validation passed

Next: I4-A2 (100-cycle production validation @ 2h intervals)"

git push origin feat/rl4-i4-ledger
git push origin v2.0.1
```

### If Test Fails:

1. Check Output Channel for errors
2. Check `.reasoning_rl4/ledger/cycles.jsonl` exists
3. Check `kernel_config.json` has correct structure
4. Run manual cycle: `Cmd+Shift+P > Reasoning: Run Cognitive Cycle`

---

## âœ¨ Files Modified

- `extension/extension.ts` (lines 85-86, 111-152, 1836-1846, 1977-1999)
  - Added `cognitiveScheduler` singleton
  - Clear timer before re-registration
  - Async flush in deactivate()

**Total changes**: ~50 lines modified

**Status**: âœ… Ready for validation

---

**Version**: v2.0.1-rc  
**Date**: 2025-11-03  
**Validation Required**: âœ… 10-cycle test + reload persistence

---

**PrÃªt ? GO !** ğŸš€

**Reload Cursor et lance le test !**
