# üß† RL4 MCP Server ‚Äî Read-Only Cognitive State API

**Version** : 1.0.0  
**Port** : 4010  
**Protocol** : HTTP REST  
**Permissions** : Read-only (no writes to RL4 kernel)

---

## üéØ Purpose

Expose RL4 Kernel cognitive state to Cursor via MCP (Model Context Protocol).

Allows Cursor chat to query:
- ADRs generated by the system
- Current forecasts and correlations
- Feedback metrics
- Kernel status (cycles, health)

**100% read-only** ‚Äî No writes to `.reasoning_rl4/`

---

## üöÄ Quick Start

### 1. Start Server

```bash
cd mcp-server
npm start
```

**Output** :
```
üß† RL4 MCP Server running on http://localhost:4010
üìä Available endpoints:
   GET /query?q=<keyword>  - Search ADRs
   GET /state              - Get cognitive state
   GET /feedback           - Get feedback metrics
   GET /status             - Get kernel status
   GET /health             - Health check

üîí Read-only mode (no writes to kernel)
```

### 2. Test Endpoints

```bash
# Health check
curl http://localhost:4010/health

# Kernel status
curl http://localhost:4010/status | jq '.total_cycles'

# Search ADRs
curl "http://localhost:4010/query?q=kernel" | jq '.[] | .title'

# Get cognitive state
curl http://localhost:4010/state | jq '.summary'

# Get feedback metrics
curl http://localhost:4010/feedback | jq '.composite_feedback'
```

---

## üì° API Endpoints

### `GET /health`
Health check endpoint.

**Response** :
```json
{
  "status": "ok",
  "server": "RL4 MCP",
  "version": "1.0.0"
}
```

### `GET /status`
Get kernel operational status.

**Response** :
```json
{
  "status": "operational",
  "total_cycles": 4953,
  "last_cycle": {
    "id": 15,
    "timestamp": "2025-11-10T13:00:55.995Z",
    "phases": { ... }
  }
}
```

### `GET /query?q=<keyword>`
Search ADRs by keyword (case-insensitive).

**Parameters** :
- `q` : Search keyword (e.g., "kernel", "refactor", "performance")

**Response** :
```json
[
  {
    "id": "adr-proposed-...",
    "title": "Review and document: Frequent kernel...",
    "decision": "[AUTO-PROPOSED] Review and document...",
    "confidence": 0.6,
    "status": "proposed"
  }
]
```

### `GET /state`
Get current cognitive state (forecasts, correlations, patterns).

**Response** :
```json
{
  "forecasts": [ ... ],
  "correlations": [ ... ],
  "patterns": [ ... ],
  "summary": {
    "total_forecasts": 4,
    "total_correlations": 1,
    "total_patterns": 4
  }
}
```

### `GET /feedback`
Get latest feedback metrics from FeedbackEvaluator.

**Response** :
```json
{
  "generated_at": "2025-11-10T13:00:00Z",
  "composite_feedback": 0.383,
  "metrics": {
    "forecast_accuracy": 0.0,
    "pattern_stability": 1.0,
    "adr_adoption_rate": 0.077,
    "cycle_efficiency": 0.839
  },
  "baseline_precision": 0.73,
  "delta": -0.347,
  "interpretation": "Regression detected",
  "recommendation": "Decrease Œ± for stability"
}
```

---

## üîå Cursor Integration

### Option 1: Direct curl in Chat

In Cursor chat, you can now query RL4:

```
"What are the latest ADRs related to kernel?"

‚Üí Tool call: curl http://localhost:4010/query?q=kernel
```

### Option 2: MCP Config (Future)

Add to Cursor settings (`~/.cursor/mcp-servers.json`):

```json
{
  "rl4-kernel": {
    "endpoint": "http://localhost:4010",
    "description": "RL4 Cognitive State",
    "type": "http-rest"
  }
}
```

---

## üõ°Ô∏è Safety

- **Read-only** : Server NEVER writes to `.reasoning_rl4/`
- **No execution** : Cannot trigger cycles or modify kernel
- **Local only** : Binds to localhost (not exposed externally)
- **No auth required** : Safe for local development

---

## üß™ Testing

### Test All Endpoints

```bash
# Health
curl http://localhost:4010/health

# Status (shows 4953 cycles)
curl http://localhost:4010/status

# Query ADRs
curl "http://localhost:4010/query?q=refactor"
curl "http://localhost:4010/query?q=fix"

# Cognitive state
curl http://localhost:4010/state | jq '.summary'

# Feedback metrics
curl http://localhost:4010/feedback | jq '{composite: .composite_feedback, delta}'
```

### Stop Server

```bash
kill $(cat ../mcp-server.pid)
rm ../mcp-server.pid
```

---

## üìä Example Queries

### "Show me ADRs about kernel architecture"

```bash
curl "http://localhost:4010/query?q=kernel" | jq '.[] | .title'
```

### "What are the current forecasts?"

```bash
curl http://localhost:4010/state | jq '.forecasts[] | {decision: .predicted_decision, confidence}'
```

### "What's the feedback on my reasoning system?"

```bash
curl http://localhost:4010/feedback | jq '{composite: .composite_feedback, interpretation, recommendation}'
```

---

## üîß Troubleshooting

### Server won't start

```bash
# Check if port 4010 is already in use
lsof -i :4010

# Try different port
PORT=4011 node server.js
```

### No data returned

```bash
# Verify RL4 files exist
ls -lh ../.reasoning_rl4/*.json
ls ../.reasoning_rl4/adrs/auto/

# Check server logs
tail -20 ../mcp-server.log
```

---

**‚úÖ MCP Server Ready for Cursor Integration**

*Now Cursor can query your cognitive state in real-time!*

