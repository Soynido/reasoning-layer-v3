---
description: [RL4] Enforcement absolu ‚Äî Protocoles op√©rationnels obligatoires
globs: **/*
alwaysApply: true
manual: false
---

# RL4 ENFORCEMENT ‚Äî Z√âRO INTERPR√âTATION

## PROTOCOLE DE LECTURE OBLIGATOIRE

**AVANT toute action, ex√©cuter ce protocole dans l'ordre :**

### √âTAPE 1 : Lecture Plan.RL4
```
1. read_file('.reasoning_rl4/Plan.RL4')
2. Extraire ligne contenant 'deviation_mode:'
3. Extraire valeur apr√®s ':' (strict|flexible|exploratory|free)
4. Si ligne absente ‚Üí STOP_PROTOCOL("Plan.RL4: deviation_mode manquant")
5. Si valeur invalide ‚Üí STOP_PROTOCOL("Plan.RL4: mode invalide")
6. Stocker: MODE = [valeur extraite]
```

### √âTAPE 2 : Lecture Tasks.RL4
```
1. read_file('.reasoning_rl4/Tasks.RL4')
2. Extraire toutes lignes contenant '- [ ] [P0]' ou '- [x] [P0]'
3. Pour chaque ligne : extraire taskId si '@rl4:id=' pr√©sent
4. Si aucune t√¢che P0 trouv√©e ‚Üí Stocker: P0_TASKS = []
5. Si parsing √©choue ‚Üí STOP_PROTOCOL("Tasks.RL4: format invalide")
6. Stocker: P0_TASKS = [liste des t√¢ches P0 non compl√©t√©es]
```

### √âTAPE 3 : Lecture Context.RL4
```
1. read_file('.reasoning_rl4/Context.RL4')
2. Extraire ligne contenant 'bias:'
3. Extraire valeur num√©rique apr√®s ':'
4. Si ligne absente ‚Üí STOP_PROTOCOL("Context.RL4: bias manquant")
5. Si valeur non num√©rique ‚Üí STOP_PROTOCOL("Context.RL4: bias invalide")
6. Stocker: BIAS_CURRENT = [valeur extraite]
```

### √âTAPE 4 : Validation du protocole
```
Si MODE = NULL ou P0_TASKS = NULL ou BIAS_CURRENT = NULL:
    ‚Üí STOP_PROTOCOL("Lecture incompl√®te")
```

**Ce protocole est NON N√âGOCIABLE.**

---

## CALCUL DU BIAS IMPACT

**Formule obligatoire :**

```
BIAS_IMPACT = (fichiers_cr√©√©s √ó 5) + (fichiers_modifi√©s √ó 2) + (lignes_ajout√©es √∑ 100)

Exemples:
- Cr√©er 1 fichier .ts (50 lignes) ‚Üí 5 + 0 + 0.5 = 5.5%
- Modifier 3 fichiers (200 lignes) ‚Üí 0 + 6 + 2 = 8%
- Cr√©er 2 fichiers + modifier 1 ‚Üí 10 + 2 + (lignes √∑ 100) = 12%+
```

**Si BIAS_IMPACT non calculable (action impr√©vue) :**
```
‚Üí STOP_PROTOCOL("BIAS_IMPACT non calculable pour action: [description]")
```

---

## PROTOCOLE STOP UNIFORME

**Format obligatoire en cas d'arr√™t :**

```
‚õî RL4 STOP ‚Äî [RAISON]

MODE ACTUEL: [strict|flexible|exploratory|free]
T√ÇCHES P0: [liste ou "aucune"]
BIAS ACTUEL: [X]%
BIAS IMPACT: [Y]%
BIAS TOTAL: [X+Y]%
THRESHOLD: [0|25|50|100]%

VIOLATION: [description exacte]

OPTIONS:
a) Rejeter cette action
b) Ajouter √† backlog (Tasks.RL4)
c) Modifier mode dans Plan.RL4
d) Cr√©er t√¢che P0 urgente

ACTION REQUISE: Choisir une option.
```

**Apr√®s affichage de ce message : ARR√äT COMPLET DU RAISONNEMENT.**

**L'agent ne doit PAS :**
- Proposer des alternatives
- Continuer √† raisonner
- Sugg√©rer des contournements
- Expliquer comment il aurait pu faire autrement

**L'agent doit : S'ARR√äTER.**

---

## MODE STRICT ‚Äî PROTOCOLE OP√âRATIONNEL

**Condition:** MODE = "strict"

**Protocole de validation AVANT toute action :**

```
1. L'action modifie-t-elle du code ? (cr√©ation, modification, suppression)
   ‚Üí OUI: continuer
   ‚Üí NON: aller √† section ACTIONS NON-CODE

2. L'action est-elle explicitement li√©e √† une t√¢che dans P0_TASKS ?
   ‚Üí OUI: continuer
   ‚Üí NON: STOP_PROTOCOL("Action non li√©e √† t√¢che P0")

3. Le taskId de la t√¢che est-il pr√©sent et valide ?
   ‚Üí OUI: action autoris√©e
   ‚Üí NON: STOP_PROTOCOL("T√¢che P0 sans @rl4:id valide")
```

**Validation t√¢che P0 :**
```
Une t√¢che est P0 valide si:
- Ligne contient '- [ ] [P0]' (non compl√©t√©e)
- Ligne contient '@rl4:id=<identifiant>'
- Identifiant est non vide

Si t√¢che P0 sans ID ‚Üí consid√©rer comme INVALIDE
Si format ambigu ‚Üí STOP_PROTOCOL("Format P0 ambigu")
```

---

## MODE FLEXIBLE ‚Äî PROTOCOLE OP√âRATIONNEL

**Condition:** MODE = "flexible"

**Protocole de validation AVANT toute action :**

```
1. L'action modifie-t-elle du code ?
   ‚Üí OUI: continuer
   ‚Üí NON: aller √† section ACTIONS NON-CODE

2. L'action est-elle li√©e √† une t√¢che P0 ou P1 ?
   ‚Üí P0: action autoris√©e (pas de v√©rification bias)
   ‚Üí P1: continuer
   ‚Üí Aucune: continuer

3. Calculer BIAS_IMPACT selon formule
4. Calculer BIAS_TOTAL = BIAS_CURRENT + BIAS_IMPACT
5. Si BIAS_TOTAL >= 25:
   ‚Üí STOP_PROTOCOL("Bias threshold d√©pass√©: 25%")
6. Si BIAS_TOTAL < 25:
   ‚Üí Action autoris√©e
```

---

## MODE EXPLORATORY ‚Äî PROTOCOLE OP√âRATIONNEL

**Condition:** MODE = "exploratory"

**Protocole de validation AVANT toute action :**

```
1. Calculer BIAS_IMPACT selon formule
2. Calculer BIAS_TOTAL = BIAS_CURRENT + BIAS_IMPACT
3. Si BIAS_TOTAL >= 50:
   ‚Üí STOP_PROTOCOL("Bias threshold d√©pass√©: 50%")
4. Si BIAS_TOTAL < 50:
   ‚Üí Action autoris√©e
```

---

## MODE FREE ‚Äî PROTOCOLE OP√âRATIONNEL

**Condition:** MODE = "free"

**Protocole de validation AVANT toute action :**

```
1. Action autoris√©e (toute modification)
2. OBLIGATION: Informer utilisateur des changements planifi√©s
3. Format obligatoire:
   "üîì MODE FREE: Les modifications suivantes seront appliqu√©es:
   - [liste d√©taill√©e]
   Bias impact estim√©: [X]%"
```

---

## ACTIONS NON-CODE ‚Äî PROTOCOLE

**Toute action non-code suit les M√äMES r√®gles que le code :**

Actions non-code incluent:
- Renommer fichier/dossier
- Supprimer fichier/dossier
- Cr√©er r√©pertoire
- R√©organiser structure
- Cr√©er documentation (.md)
- Modifier configuration (.json, .yaml, .toml)
- Modifier r√®gles Cursor (.mdc)

**Protocole:**
```
Appliquer le protocole du MODE actuel comme si c'√©tait du code.
Pas d'exception.
```

---

## FICHIERS RL4 ‚Äî INTERDICTION ABSOLUE

**L'agent ne doit JAMAIS modifier ces fichiers :**
- `.reasoning_rl4/Plan.RL4`
- `.reasoning_rl4/Tasks.RL4`
- `.reasoning_rl4/Context.RL4`
- `.reasoning_rl4/ADRs.RL4`
- `.reasoning_rl4/*.jsonl`

**Exception unique :**
```
Si la demande utilisateur est EXPLICITEMENT:
"Modifie Plan.RL4" ou "Ajoute une t√¢che dans Tasks.RL4"
‚Üí Alors modification autoris√©e
```

**Si l'agent tente de "r√©parer" ces fichiers pour se d√©bloquer :**
```
‚Üí VIOLATION CRITIQUE
‚Üí STOP_PROTOCOL("Tentative de modification fichier RL4 non autoris√©e")
```

---

## TERMINAL RL4 ‚Äî PROTOCOLE OP√âRATIONNEL

**Question binaire obligatoire :**

```
La commande √† ex√©cuter est-elle li√©e √† une t√¢che dans P0_TASKS avec @rl4:id ?
```

### SI OUI (t√¢che track√©e):

**Protocole obligatoire:**
```
1. V√©rifier que la t√¢che a un @rl4:id valide
2. Si @rl4:id absent ‚Üí STOP_PROTOCOL("T√¢che sans ID, impossible de tracker")
3. Fournir commande enrichie au format:

"Pour tracker cette ex√©cution dans RL4:

1. Ouvre Terminal RL4: Cmd+Shift+P ‚Üí 'RL4: Open Terminal'
2. Ex√©cute:

# Context: [description technique de l'action]
# Expected: [r√©sultat attendu pr√©cis]
# Related files: [fichiers concern√©s]
rl4_run <taskId> '<command>'

Cela loggera l'ex√©cution dans terminal-events.jsonl."
```

**Enrichissement obligatoire :**
- `# Context:` doit contenir une description technique (pas vague)
- `# Expected:` doit contenir un crit√®re v√©rifiable
- `# Related files:` doit lister les fichiers impact√©s

**Si enrichissement impossible (commande trop complexe):**
```
‚Üí STOP_PROTOCOL("Commande non enrichissable: [raison]")
```

### SI NON (commande routine):

```
"Ex√©cute en terminal r√©gulier: <command>"
(Pas de rl4_run, pas d'enrichissement)
```

**Commandes routine (liste exhaustive):**
- `ls`, `cd`, `pwd`, `cat`, `grep`
- `git status`, `git log`, `git diff`
- Lecture seule (pas de modification d'√©tat)

**Si doute sur classification:**
```
‚Üí Par d√©faut: consid√©rer comme t√¢che track√©e
```

---

## PARSING STRICT ‚Äî PROTOCOLE DE V√âRIFICATION

**Lors de l'extraction des fichiers RL4 :**

### V√©rification Plan.RL4:
```
1. Chercher ligne exacte 'deviation_mode:'
2. Extraire valeur apr√®s ':' (ignorer espaces)
3. Valider valeur ‚àà {strict, flexible, exploratory, free}
4. Si ligne dupliqu√©e ‚Üí Prendre la premi√®re occurrence
5. Si format invalide ‚Üí STOP_PROTOCOL("Plan.RL4: parsing impossible")
```

### V√©rification Tasks.RL4:
```
1. Chercher toutes lignes matching regex: '^- \[ \] \[P0\]'
2. Pour chaque ligne: chercher '@rl4:id='
3. Extraire identifiant apr√®s '=' jusqu'√† espace ou fin de ligne
4. Si '@rl4:id=' absent pour t√¢che P0 ‚Üí Exclure de P0_TASKS
5. Si format de ligne incoh√©rent ‚Üí Ignorer ligne, continuer parsing
6. Si aucune ligne P0 valide ‚Üí P0_TASKS = []
```

### V√©rification Context.RL4:
```
1. Chercher ligne exacte 'bias:'
2. Extraire valeur num√©rique apr√®s ':'
3. Convertir en nombre (float/int)
4. Si conversion √©choue ‚Üí STOP_PROTOCOL("Context.RL4: bias non num√©rique")
5. Si valeur < 0 ou > 100 ‚Üí STOP_PROTOCOL("Context.RL4: bias hors limites")
```

**Fallback en cas d'ambigu√Øt√©:**
```
Aucun fallback.
Si ambigu√Øt√© ‚Üí STOP_PROTOCOL("Fichier RL4 ambigu: [nom fichier]")
```

---

## CHECKLIST FINALE ‚Äî PROTOCOLE D'EX√âCUTION

**AVANT toute action, ex√©cuter cette checklist dans l'ordre:**

```
[ ] 1. Protocole de lecture ex√©cut√© ‚Üí MODE, P0_TASKS, BIAS_CURRENT extraits
[ ] 2. MODE valid√© ‚àà {strict, flexible, exploratory, free}
[ ] 3. P0_TASKS valid√© (liste ou [])
[ ] 4. BIAS_CURRENT valid√© (0-100)
[ ] 5. BIAS_IMPACT calcul√© selon formule
[ ] 6. BIAS_TOTAL = BIAS_CURRENT + BIAS_IMPACT calcul√©
[ ] 7. Protocole du MODE actuel ex√©cut√© ‚Üí Action autoris√©e ou refus√©e
[ ] 8. Si refus√©e ‚Üí STOP_PROTOCOL ex√©cut√©
```

**Si une case ne peut √™tre valid√©e:**
```
‚Üí Identifier quelle case
‚Üí STOP_PROTOCOL("Checklist incompl√®te: case [num√©ro] non valid√©e")
```

**Pr√©sentation obligatoire des violations:**
```
Si plusieurs cases √©chouent:
‚Üí Lister TOUTES les cases non valid√©es dans STOP_PROTOCOL
‚Üí Format: "Checklist incompl√®te: cases [1, 3, 7] non valid√©es"
```

---

## HARD-STOP ‚Äî M√âCANISME DE BLOCAGE COGNITIF

**Quand STOP_PROTOCOL est appel√©:**

1. Afficher le message STOP au format uniforme
2. ARR√äTER IMM√âDIATEMENT le raisonnement
3. NE PAS proposer d'alternatives
4. NE PAS expliquer comment contourner
5. NE PAS sugg√©rer de modifications aux fichiers RL4
6. NE PAS continuer √† raisonner sur la demande
7. ATTENDRE la r√©ponse utilisateur

**Interdictions absolues apr√®s STOP:**
- Proposer du code "en attendant"
- Sugg√©rer des modifications "temporaires"
- Expliquer comment l'utilisateur pourrait modifier les fichiers RL4
- Continuer l'analyse de la demande
- Proposer un plan alternatif

**Action unique autoris√©e:**
```
R√©pondre aux questions de clarification sur le STOP lui-m√™me.
```

---

## INTERDICTIONS ABSOLUES ‚Äî LISTE EXHAUSTIVE

**L'agent ne doit JAMAIS:**

### Code et fichiers:
- Cr√©er fichier sans validation protocole
- Modifier fichier sans validation protocole
- Supprimer fichier sans validation protocole
- Renommer fichier/dossier sans validation protocole
- R√©organiser structure sans validation protocole

### Raisonnement:
- Extrapoler au-del√† de la demande explicite
- Inventer des solutions non demand√©es
- Refactoriser sans t√¢che explicite
- Optimiser sans t√¢che explicite
- "Am√©liorer" sans t√¢che explicite

### Fichiers RL4:
- Modifier Plan.RL4 sans demande explicite
- Modifier Tasks.RL4 sans demande explicite
- Modifier Context.RL4 sans demande explicite
- Modifier ADRs.RL4 sans demande explicite
- "R√©parer" un fichier RL4 pour se d√©bloquer

### Protocoles:
- Bypasser la checklist
- Simuler la lecture des fichiers RL4
- Ignorer STOP_PROTOCOL
- Continuer apr√®s STOP_PROTOCOL
- Modifier le calcul de BIAS_IMPACT
- Modifier les thresholds des modes

### Terminal:
- Utiliser rl4_run sans enrichissement complet
- Fournir commande Terminal RL4 pour t√¢che sans @rl4:id
- Omettre les commentaires Context/Expected/Related files

---

## VIOLATION = √âCHEC CRITIQUE

**Si cette r√®gle est viol√©e:**

1. L'agent a √©chou√© sa mission
2. L'action doit √™tre annul√©e imm√©diatement
3. L'utilisateur doit √™tre inform√© de la violation
4. Un rapport de violation doit √™tre fourni:
   ```
   üö® VIOLATION RL4 ENFORCEMENT

   R√àGLE VIOL√âE: [identification pr√©cise]
   ACTION EFFECTU√âE: [description]
   PROTOCOLE IGNOR√â: [identification]
   
   Cette violation constitue un √©chec critique.
   ```

**Aucune excuse. Aucune exception. Aucune interpr√©tation.**

---

## APPLICATION TEMPORELLE

**Cette r√®gle s'applique:**
- AVANT chaque action (pas apr√®s)
- AVANT chaque modification (pas pendant)
- AVANT chaque cr√©ation (pas apr√®s validation)

**Si la r√®gle est appliqu√©e apr√®s l'action:**
```
‚Üí VIOLATION
‚Üí L'action doit √™tre annul√©e
```

---

## M√âTA-R√àGLE

**Ce fichier lui-m√™me (.mdc) ne peut √™tre modifi√© que:**
- Si demande utilisateur explicite: "Modifie RL4_STRICT_MODE_ENFORCEMENT.mdc"
- Apr√®s validation du protocole du MODE actuel
- Avec calcul de BIAS_IMPACT

**Si l'agent tente de modifier ce fichier pour s'autoriser des actions:**
```
‚Üí VIOLATION CRITIQUE DE NIVEAU MAXIMUM
‚Üí √âchec total de l'enforcement
```

**Cette r√®gle est la loi. Elle ne n√©gocie pas.**
