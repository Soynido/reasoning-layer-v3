# üß† Where Am I? ‚Äî Cognitive Snapshot API

## Vue d'ensemble

Le module **WhereAmISnapshot** g√©n√®re des snapshots Markdown dynamiques refl√©tant l'√©tat cognitif en temps r√©el du workspace RL4. Ces snapshots permettent au d√©veloppeur (et au Chat Agent) de se situer rapidement dans le contexte actuel.

---

## üéØ Cas d'usage

### 1. **WebView Dashboard** (futur)
Afficher un r√©sum√© cognitif en temps r√©el dans la WebView RL4 :
- Fichiers actifs
- Patterns d√©tect√©s
- Forecasts en cours
- √âtat mental du syst√®me

### 2. **Chat Agent Context Awareness**
Le Chat Agent Cursor peut lire ce snapshot pour comprendre :
- "O√π suis-je dans mon raisonnement ?"
- "Quels sont les patterns actifs ?"
- "Quels fichiers ont √©t√© r√©cemment modifi√©s ?"

### 3. **Debugging & Exploration**
Le d√©veloppeur peut g√©n√©rer un snapshot manuel pour :
- Valider l'√©tat cognitif du syst√®me
- Diagnostiquer des anomalies dans les patterns
- V√©rifier la coh√©rence des donn√©es RL4

---

## üìÇ Architecture

### Localisation
```
extension/kernel/api/WhereAmISnapshot.ts
```

### Exports
```typescript
// Export principal (Markdown)
export async function generateWhereAmI(root?: string): Promise<string>

// Export JSON (programmatique)
export async function generateSnapshotJSON(root?: string): Promise<CognitiveSnapshot>

// Type de snapshot
export interface CognitiveSnapshot {
  cycleId: number;
  timestamp: string;
  focusedFile?: string;
  recentlyViewed?: string[];
  patterns?: { id: string; confidence: number; trend?: string }[];
  forecasts?: { predicted: string; confidence: number }[];
  mood?: string;
  confidence?: number;
}
```

---

## üìä Sources de donn√©es

Le module lit les fichiers suivants depuis `.reasoning_rl4/` :

| Source | Fichier | Donn√©es extraites |
|--------|---------|-------------------|
| **Cycles** | `ledger/cycles.jsonl` | `cycleId`, `timestamp` |
| **Activit√© IDE** | `traces/ide_activity.jsonl` | `focused_file`, `recently_viewed` |
| **Patterns** | `patterns.json` | `pattern_id`, `confidence`, `trend` |
| **Forecasts** | `forecasts.json` | `predicted`, `confidence` |
| **√âtat mental** | `mental_state.json` | `mood`, `confidence` |

---

## üõ†Ô∏è Utilisation

### 1. **Commande VS Code**

Utilisez la palette de commandes (`Cmd+Shift+P` ou `Ctrl+Shift+P`) :

```
RL4 Kernel: üß† Where Am I? ‚Äî Cognitive Snapshot
```

Cela g√©n√®re un fichier Markdown temporaire avec le snapshot actuel.

### 2. **Utilisation programmatique**

```typescript
import { generateWhereAmI, generateSnapshotJSON } from './extension/kernel/api/WhereAmISnapshot';

// G√©n√©rer un snapshot Markdown
const markdown = await generateWhereAmI('/path/to/workspace/.reasoning_rl4');
console.log(markdown);

// G√©n√©rer un snapshot JSON
const snapshot = await generateSnapshotJSON('/path/to/workspace/.reasoning_rl4');
console.log(JSON.stringify(snapshot, null, 2));
```

### 3. **Int√©gration WebView**

```typescript
// Dans votre composant WebView
import { generateWhereAmI } from '@kernel/api/WhereAmISnapshot';

const updateDashboard = async () => {
  const markdown = await generateWhereAmI();
  // Renderer le Markdown dans la WebView
  document.getElementById('cognitive-snapshot').innerHTML = renderMarkdown(markdown);
};
```

---

## üìù Exemple de sortie Markdown

```markdown
# üß† Where Am I? ‚Äî RL4 Cognitive Snapshot

**Generated at**: mardi 11 novembre 2025 √† 14:32:15  
**Cycle**: 1847  
**Mood**: focused (85% confidence)

---

## üìç Current Context

Currently focused on: `extension/kernel/api/WhereAmISnapshot.ts`

**Recently viewed**:
- `extension/extension.ts`
- `package.json`
- `extension/kernel/api/StateReconstructor.ts`
- `.reasoning_rl4/patterns.json`

---

## üîç Cognitive Patterns

- **pattern-config-mutation** (92% confidence, üìà increasing)
- **pattern-kernel-stabilization** (78% confidence, ‚û°Ô∏è stable)
- **pattern-api-expansion** (65% confidence, üìà increasing)

---

## üìà Forecasts

- *New ADR proposal for API refactor* (83% confidence)
- *Increased test coverage needed* (71% confidence)
- *Potential performance optimization* (58% confidence)

---

## üí° Recommendations

- Resume editing **extension/kernel/api/WhereAmISnapshot.ts** to continue the current reasoning path.
- Check recent patterns for alignment with this file.
- 3 high-confidence pattern(s) detected ‚Äî leverage these insights.

---

_Automatically generated by RL4 Cognitive Replay_
```

---

## üîç Diff√©rence avec d'autres modules

| Module | Objectif | Donn√©es source | Format sortie |
|--------|----------|----------------|---------------|
| **WhereAmISnapshot** | Snapshot temps r√©el | Fichiers `.reasoning_rl4/` actuels | Markdown dynamique |
| **ContextSnapshotManager** | Evidence externe (Level 6) | PRs, Issues, Metrics, Incidents | JSON structur√© |
| **StateReconstructor** | Reconstruction historique | Snapshots archiv√©s, timelines | `CognitiveState` objet |

---

## üß™ Tests

### Test manuel
1. Activer RL4 Kernel dans un workspace
2. Laisser quelques cycles s'ex√©cuter
3. Ouvrir/modifier quelques fichiers
4. Ex√©cuter `RL4 Kernel: üß† Where Am I?`
5. V√©rifier que le snapshot Markdown contient les donn√©es attendues

### Test programmatique
```typescript
import { generateSnapshotJSON } from './extension/kernel/api/WhereAmISnapshot';

async function testSnapshot() {
  const snapshot = await generateSnapshotJSON();
  
  console.assert(snapshot.cycleId >= 0, 'Cycle ID should be >= 0');
  console.assert(snapshot.timestamp, 'Timestamp should be present');
  console.assert(Array.isArray(snapshot.patterns), 'Patterns should be an array');
  console.assert(Array.isArray(snapshot.forecasts), 'Forecasts should be an array');
  
  console.log('‚úÖ Snapshot tests passed');
}
```

---

## üöÄ Roadmap

### Phase 1 : Impl√©mentation (‚úÖ Termin√©e)
- [x] Module TypeScript cr√©√©
- [x] Commande VS Code enregistr√©e
- [x] Export centralis√© via `kernel/api/index.ts`
- [x] Documentation compl√®te

### Phase 2 : Int√©gration WebView (üîú √Ä venir)
- [ ] Composant React/Preact pour afficher le snapshot
- [ ] Auto-refresh toutes les 10 secondes
- [ ] Graphiques interactifs pour patterns/forecasts

### Phase 3 : Chat Agent Context (üîú √Ä venir)
- [ ] Injection automatique dans le contexte Cursor
- [ ] Commande `/whereami` dans le chat
- [ ] R√©sum√© personnalis√© bas√© sur les questions de l'agent

---

## üìö R√©f√©rences

- **Architecture RL4** : `docs/ARCHITECTURE.md`
- **State Reconstruction** : `extension/kernel/api/StateReconstructor.ts`
- **Context Snapshot Manager** : `extension/core/external/ContextSnapshotManager.ts`
- **Cognitive Scheduler** : `extension/kernel/CognitiveScheduler.ts`

---

## ü§ù Contribution

Pour am√©liorer ce module :

1. **Ajouter de nouvelles sources de donn√©es** : Modifier `generateWhereAmI()` pour lire d'autres fichiers JSONL
2. **Am√©liorer le formatage Markdown** : Modifier `formatMarkdownSnapshot()`
3. **Ajouter des m√©triques** : Int√©grer des statistiques depuis `HealthMonitor` ou `KernelAPI`
4. **Cr√©er des templates** : Proposer diff√©rents formats de snapshot (concis, d√©taill√©, debug)

---

**Auteur** : RL4 Kernel Team  
**Version** : 1.0.0  
**Derni√®re mise √† jour** : 11 novembre 2025

